{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DESQL'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\n# PATH                      = require 'path'\n# FS                        = require 'fs'\ntypes                     = new ( require 'intertype' ).Intertype\n{ isa\n  equals\n  type_of\n  validate\n  validate_list_of }      = types.export()\nGUY                       = require 'guy'\n# { HDML }                  = require '../../../apps/hdml'\nX                         = require '../../hengist/lib/helpers'\n# { lets\n#   freeze }                = GUY.lft\n# { to_width }              = require 'to-width'\n# { DBay }                  = require '../../../apps/dbay'\nSQL                       = String.raw\n# { SQL }                   = DBay\n# { Sql }                   = require '../../../apps/dbay/lib/sql'\nxrpr                      = ( x ) -> ( require 'util' ).inspect x, {\n  colors: true, depth: Infinity, maxArrayLength: null, breakLength: Infinity, }\nto_snake_case             = require 'just-snake-case'\n{ antlr: ANTLR          } = require 'rhombic'\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nshow_overview = ( db ) ->\n  info '#############################################################################'\n  X.tabulate \"dbay_tables\",                   db SQL\"select * from dbay_tables\"\n  X.tabulate \"dbay_unique_fields\",            db SQL\"select * from dbay_unique_fields\"\n  # X.tabulate \"dbay_fields_1\",                 db SQL\"select * from dbay_fields_1\"\n  X.tabulate \"dbay_fields\",                   db SQL\"select * from dbay_fields\"\n  X.tabulate \"dbay_foreign_key_clauses_1\",    db SQL\"select * from dbay_foreign_key_clauses_1\"\n  X.tabulate \"dbay_foreign_key_clauses_2\",    db SQL\"select * from dbay_foreign_key_clauses_2\"\n  # X.tabulate \"dbay_foreign_key_clauses_3\",    db SQL\"select * from dbay_foreign_key_clauses_3\"\n  X.tabulate \"dbay_foreign_key_clauses\",      db SQL\"select * from dbay_foreign_key_clauses\"\n  X.tabulate \"dbay_primary_key_clauses_1\",    db SQL\"select * from dbay_primary_key_clauses_1\"\n  X.tabulate \"dbay_primary_key_clauses\",      db SQL\"select * from dbay_primary_key_clauses\"\n  # X.tabulate \"dbay_field_clauses_1\",          db SQL\"select * from dbay_field_clauses_1\"\n  X.tabulate \"dbay_field_clauses\",            db SQL\"select * from dbay_field_clauses\"\n  # X.tabulate \"dbay_create_table_clauses\",     db SQL\"select * from dbay_create_table_clauses\"\n  # X.tabulate \"dbay_create_table_statements_1\", db SQL\"select * from dbay_create_table_statements_1\"\n  # X.tabulate \"dbay_create_table_statements_2\", db SQL\"select * from dbay_create_table_statements_2\"\n  # X.tabulate \"dbay_create_table_statements_3\", db SQL\"select * from dbay_create_table_statements_3\"\n  # X.tabulate \"dbay_create_table_statements_4\", db SQL\"select * from dbay_create_table_statements_4\"\n  # X.tabulate \"dbay_create_table_statements\",  db SQL\"select * from dbay_create_table_statements\"\n  # X.tabulate \"dbay_create_table_statements\",  db SQL\"\"\"\n  #   select\n  #       lnr,\n  #       tail,\n  #       substring( txt, 1, 100 ) as txt\n  #     from dbay_create_table_statements;\"\"\"\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\ntabulate = ( db, query ) -> X.tabulate query, db query\n\n#-----------------------------------------------------------------------------------------------------------\nqueries = [\n  SQL\"drop view if exists dbay_foreign_key_clauses_2;\",\n  SQL\"\"\"\n    create view dbay_foreign_key_clauses_2 as select distinct\n        fk_id                                                                     as fk_id,\n        from_table_nr                                                             as from_table_nr,\n        from_table_name                                                           as from_table_name,\n        group_concat( std_sql_i( from_field_name ), ', ' ) over w                 as from_field_names,\n        to_table_name                                                             as to_table_name,\n        group_concat( std_sql_i(   to_field_name ), ', ' ) over w                 as to_field_names\n      from dbay_foreign_key_clauses_1\n      window w as (\n        partition by from_table_name, fk_id\n        order by fk_idx\n        rows between unbounded preceding and unbounded following )\n      order by from_table_name, fk_id, fk_idx;\"\"\"\n  SQL\"create table d ( x integer ) strict;\"\n  SQL\"\"\"create table d ( x \"any\" );\"\"\"\n  SQL\"insert into products ( nr, name ) values ( 1234, 'frob' );\"\n  SQL\"select a, b from s join t using ( c );\"\n  SQL\"select t1.a as alias, t2.b from s as t1 join t as t2 using ( c );\"\n  SQL\"create view v as select a, b, c, f( d ) as k from t where e > 2;\"\n  SQL\"create view v as select a, b, c, f( d ) as k from t join t2 using ( uuu ) where e > 2 order by k;\"\n  SQL\"select a, b, c, f( d ) as k from t join t2 using ( uuu ) where e > 2 order by k;\"\n  SQL\"\"\"select\n    42 as d;\n    select 'helo world' as greetings;\"\"\"\n  SQL\"\"\"select xxxxx /* comment */ from t where \"x\" = $x;\"\"\"\n  ]\n\n#-----------------------------------------------------------------------------------------------------------\n@demo_rhombic_antlr = ->\n  CATALOG = require '../../../jzr-old/multimix/lib/cataloguing'\n  # q = antlr.parse \"SELECT * FROM abc join users as u;\", parser_cfg\n  # for query in [ SQL\"\"\"select d as \"d1\" from a as a1;\"\"\", ]\n  # for query in [ SQL\"\"\"select d + e + f( x ) as \"d1\" from a as a1;\"\"\", ]\n  # for query in [ SQL\"\"\"select * from a left join b where k > 1 order by m limit 1;\"\"\", ]\n  # for query in [ SQL\"SELECT 42 as a;\", ]\n  # for query in [ queries[ 1 ], ]\n  for query in [ queries[ queries.length - 1 ], ]\n    echo query\n    X.banner query\n    build_tree query\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\ntype_of_antler_node = ( node ) ->\n  R = node.constructor.name\n  R = R.replace /(Node|Context)$/, ''\n  R = to_snake_case R\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\nbuild_tree = ( query ) ->\n  parser_cfg      =\n    doubleQuotedIdentifier: true\n  antlr           = { children: [ ( ANTLR.parse query, parser_cfg ).tree, ], }\n  R               = { type: 'query', nodes: [], }\n  series          = []\n  objects_by_type = _build_tree query, antlr, 0, 0, series, R\n  # types           = ( k for k of objects_by_type ).sort()\n  debug '^4345^', R\n  show_series query, series\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\nshow_series = ( query, series ) ->\n  s = []\n  for node in series\n    s.push\n      id:         node.id\n      upid:       node.upid\n      type:       node.type\n      start_idx:  node.start?.idx ? null\n      start_lnr:  node.start?.lnr ? null\n      start_col:  node.start?.col ? null\n      stop_idx:   node.stop?.idx ? null\n      stop_lnr:   node.stop?.lnr ? null\n      stop_col:   node.stop?.col ? null\n      node_count: node.node_count\n      text:       node.text\n  X.tabulate query, s\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n_build_tree = ( query, antlr, upid, level, series, tree ) ->\n  dent  = '  '.repeat level\n  id    = upid\n  for branch in antlr.children\n    id++\n    type            = type_of_antler_node branch\n    type_entry      = antler_types[ type ]\n    position        = position_from_node branch\n    if position?\n      position_txt    = \"(#{position.start.lnr}:#{position.start.col}–#{position.stop.lnr}:#{position.stop.col})\"\n      text            = query[ position.start.idx .. position.stop.idx ]\n    else\n      position_txt    = ''\n      text            = ''\n    flat_node       = { id, upid, type, position..., }\n    flat_node.text  = if text is '' then null else text\n    node            = { flat_node..., nodes: [], }\n    series.push flat_node\n    tree.nodes.push node\n    switch type_entry_type = type_of type_entry\n      when 'undefined'\n        warn '^4656-1^' + dent + \" #{id} (#{upid}) #{type} #{position_txt} #{CND.gold rpr shorten text} \"\n      when 'null'\n        whisper '^4656-1^' + dent + \" #{id} (#{upid}) #{type} #{position_txt} #{CND.gold rpr shorten text} \"\n      when 'function'\n        whisper '^5600-14^', '------------------------------------------------------------'\n        info '^4656-1^' + dent + \" #{id} (#{upid}) #{type} #{position_txt} #{CND.gold rpr shorten text} \"\n        debug '^4656-1^', type_entry branch\n      else\n        warn CND.reverse '^4656-1^' + dent + \" #{id} (#{upid}) #{type} #{position_txt} #{CND.gold rpr shorten text} \" + \" unknown type entry type #{rpr type_entry_type}\"\n    if branch.children?\n      _build_tree query, branch, id, level + 1, series, node\n    flat_node.node_count = node.nodes.length\n    delete node.nodes if node.nodes.length is 0\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nshorten = ( text ) ->\n  return text unless text.length > 20\n  return text[ .. 9 ] + '...' + text[ text.length - 9 ... ]\n\n#-----------------------------------------------------------------------------------------------------------\nposition_from_node = ( node ) ->\n  if node._symbol?\n    start     =\n      idx:  node._symbol.start\n      lnr:  node._symbol._line\n      col:  node._symbol._charPositionInLine + 1\n    stop      =\n      idx:  node._symbol.stop\n      lnr:  node._symbol._line\n      col:  node._symbol._charPositionInLine + 1 + node._symbol.stop - node._symbol.start\n    return { start, stop, }\n  return null\n  # else if node._start?\n  #   start     =\n  #     idx:  node._start.start\n  #     lnr:  node._start._line\n  #     col:  node._start._charPositionInLine + 1\n  #   stop      =\n  #     idx:  node._stop.stop\n  #     lnr:  node._stop._line\n  #     col:  node._stop._charPositionInLine + 1\n\n#-----------------------------------------------------------------------------------------------------------\nantler_types =\n  #.........................................................................................................\n  terminal: null\n  #.........................................................................................................\n  select_clause: ( node ) ->\n    terminal  = node.children[ 0 ]\n    unless ( type = type_of_antler_node terminal ) is 'terminal'\n      throw new Error \"unexpected type #{rpr type}\"\n    unless ( /^select$/i  ).test ( text = terminal.text )\n      throw new Error \"unexpected terminal #{rpr text}\"\n    debug '^4353^', { type, text, ( position_from_node terminal )..., nodes: [], }\n  #.........................................................................................................\n  regular_query_specification:  null\n  query_primary_default:        null\n  query_term_default:           null\n  query:                        null\n  statement_default:            null\n\n\n\n\n############################################################################################################\nif module is require.main then do =>\n  @demo_rhombic_antlr()\n\n\n#   #---------------------------------------------------------------------------------------------------------\n#   _walk_statements_from_path: ( sql_path ) ->\n#     ### Given a path, iterate over SQL statements which are signalled by semicolons (`;`) that appear outside\n#     of literals and comments (and the end of input). ###\n#     ### thx to https://stackabuse.com/reading-a-file-line-by-line-in-node-js/ ###\n#     ### thx to https://github.com/nacholibre/node-readlines ###\n#     readlines       = new ( require 'n-readlines' ) sql_path\n#     #.......................................................................................................\n#     cfg           =\n#       regExp: ( require 'mysql-tokenizer/lib/regexp-sql92' )\n#     tokenize      = ( require 'mysql-tokenizer' ) cfg\n#     collector     = null\n#     # stream        = FS.createReadStream sql_path\n#     #.......................................................................................................\n#     flush = ->\n#       R         = collector.join ''\n#       collector = null\n#       return R\n#     #.......................................................................................................\n#     while ( line = readlines.next() ) isnt false\n#       for token, cur_idx in tokenize line + '\\n'\n#         if token is ';'\n#           ( collector ?= [] ).push token\n#           yield flush()\n#           continue\n#         # if token.startsWith '--'\n#         #   continue\n#         ( collector ?= [] ).push token\n#     #.......................................................................................................\n#     yield flush() if collector?\n#     return null\n\n"
  ]
}