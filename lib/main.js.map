{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DESQL'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\ntypes                     = new ( require 'intertype' ).Intertype\n{ isa\n  equals\n  type_of\n  validate\n  validate_list_of }      = types.export()\nGUY                       = require 'guy'\n{ DBay }                  = require 'dbay'\n{ SQL }                   = DBay\nto_snake_case             = require 'just-snake-case'\n{ antlr: ANTLR          } = require 'rhombic'\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nclass @Desql\n\n  @C: GUY.lft.freeze\n    pathsep:  '-'\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( P... ) ->\n    throw new Error \"^345^ configuration settings not supported\" if P.length > 0\n    @db = new DBay()\n    @_procure_infrastructure()\n    @_procure_infradata()\n    @_compile_sql()\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _procure_infradata: ->\n    @db SQL\"\"\"\n      insert into ntypes ( name, short ) values\n        -- .................................................................................................\n        ( 'spc',                                'spc'       ),\n        ( 'miss',                               'miss'      ),\n        ( 'start',                              'start'     ),\n        ( 'stop',                               'stop'      ),\n        -- .................................................................................................\n        ( 'ansi_non_reserved',                  'ansinr'    ),\n        ( 'arithmetic_binary',                  'arthbin'   ),\n        ( 'aliased_query',                      'aq'        ),\n        ( 'column_reference',                   'cref'      ),\n        ( 'col_type_list',                      'cltl'      ),\n        ( 'col_type',                           'clt'       ),\n        ( 'constant',                           'c'         ),\n        ( 'comparison',                         'cmp'       ),\n        ( 'comparison_operator',                'cmpop'     ),\n        ( 'create_table',                       'ctable'    ),\n        ( 'create_table_header',                'ctableh'   ),\n        ( 'create_view',                        'cview'     ),\n        ( 'dereference',                        'dref'      ),\n        ( 'dml_statement',                      'dml'       ),\n        ( 'drop_view',                          'dropv'     ),\n        ( 'error_capturing_identifier',         'eci'       ),\n        ( 'expression',                         'e'         ),\n        ( 'frame_bound',                        'fb'        ),\n        ( 'from_clause',                        'from'      ),\n        ( 'function_call',                      'fc'        ),\n        ( 'function_name',                      'fn'        ),\n        ( 'identifier',                         'i'         ),\n        ( 'insert_into_table',                  'iit'       ),\n        ( 'join_relation',                      'jr'        ),\n        ( 'join_criteria_on',                   'jco'       ),\n        ( 'join_criteria_using',                'jcu'       ),\n        ( 'identifier_list',                    'il'        ),\n        ( 'identifier_seq',                     'is'        ),\n        ( 'inline_table',                       'it'        ),\n        ( 'inline_table_default1',              'itd1'      ),\n        ( 'multipart_identifier',               'mi'        ),\n        ( 'named_expression',                   'ne'        ),\n        ( 'named_expression_seq',               'nes'       ),\n        ( 'named_window',                       'nw'        ),\n        ( 'numeric_literal',                    'nl'        ),\n        ( 'integer_literal',                    'int'       ),\n        ( 'parenthesized_expression',           'pe'        ),\n        ( 'predicated',                         'pd'        ),\n        ( 'primitive_data_type',                'pdt'       ),\n        ( 'qualified_name',                     'qn'        ),\n        ( 'query',                              'q'         ),\n        ( 'query_organization',                 'qo'        ),\n        ( 'query_primary',                      'qp'        ),\n        ( 'query_term',                         'qt'        ),\n        ( 'quoted_identifier',                  'qi'        ),\n        ( 'quoted_identifier_alternative',      'qia'       ),\n        ( 'regular_query_specification',        'rqs'       ),\n        ( 'relation',                           'r'         ),\n        ( 'row_constructor',                    'roco'      ),\n        ( 'searched_case',                      'case'      ),\n        ( 'select_clause',                      'select'    ),\n        ( 'set_quantifier',                     'sq'        ),\n        ( 'single_insert_query',                'siq'       ),\n        ( 'sort_item',                          'si'        ),\n        ( 'string_literal',                     'str'       ),\n        ( 'statement',                          's'         ),\n        ( 'table_alias',                        'ta'        ),\n        ( 'table_name',                         'tn'        ),\n        ( 'terminal',                           't'         ),\n        ( 'unquoted_identifier',                'ui'        ),\n        ( 'value_expression',                   've'        ),\n        ( 'when_clause',                        'when'      ),\n        ( 'where_clause',                       'where'     ),\n        ( 'window_clause',                      'window'    ),\n        ( 'window_def',                         'wd'        ),\n        ( 'window_frame',                       'wf'        ),\n        ( 'window_ref',                         'wr'        );\"\"\"\n    #.......................................................................................................\n    for name in [\n        'i function name'\n        'i join on col name'\n        'i join on tbl alias'\n        'i join on tbl name'\n        'i order by col name'\n        'i order by tbl name'\n        'i other'\n        'i select from col alias'\n        # 'i select from col name'\n        'i select from tbl alias'\n\n        'i select from'\n        'i tbl name'\n        'i col name'\n\n        'k generated always as'\n        'k generated always'\n        'k generated'\n        'k insert into'\n        'k insert'\n        'k join on'\n        'k join using'\n        'k join'\n        'k order by ascending'\n        'k order by descending'\n        'k order by'\n        'k order'\n        'k select from'\n        'k select'\n        'k where'\n        'k window as'\n        'k window'\n        'k with'\n        'l other'\n        'r create view'\n        's bracket round left'\n        's bracket round right'\n        's colon'\n        's comma'\n        's dot'\n        's o-perator'\n        's semi-colon'\n        's spc' ]\n      { code, name, } = @_code_and_name_from_tcat_name name\n      try\n        @db SQL\"insert into tcats ( code, name ) values ( $code, $name )\", { code, name, }\n      catch error\n        debug error.name\n        throw error unless error.code in [ 'SQLITE_CONSTRAINT_UNIQUE', 'SQLITE_CONSTRAINT_PRIMARYKEY', ]\n        throw new Error \"^desql/_procure_infradata@1^ tcat code: #{rpr code} (name: #{rpr name}) is not unique\"\n    #.......................................................................................................\n    for [ name, matcher, ] in [\n      [ 'i function name', '-fc-fn-qn-i-[uq]i-t$' ]\n      [ 'i other',          '-i-[uq]i-t$',              ]\n      [ 'l other',          '-c-.*-t$',                 ]\n      [ 'r create view',    '-cv-',                     ]\n      [ 'i select from',    '-s-.*-from-.*-i-[uq]i-t$', ]\n      [ 'k select from',    '-s-.*-from-t$',            ]\n      [ 'k select',         '-s-.*-select-t$',          ]\n      [ 'i tbl name',       '-tn-.*-i-[uq]i-t$',        ]\n      [ 'i col name',       '-ve-cref-i-[uq]i-t$',      ]\n      [ 's dot',            '-ve-dref-t$',              ]\n      ]\n      #.....................................................................................................\n\n      # [ 'view name',                                '-cv-mi-eci-i-[uq]i-t$'                     ]\n      # [ 'tbl name in fqn (`t.col`)',              '-dref-cref-i-[uq]i-t$'                     ]\n      # [ 'col name in fqn (`t.col`)',                '-dref-i-[uq]i-t$'                          ]\n      # [ 'col name in fqn (`t.col`) (also SQL kw)',  '-dref-i-[uq]i-ansinr-t$'                   ]\n      # [ 'col name in select',                       '-select-nes-ne-e-pd-ve.*-cref-i-[uq]i-t$'  ]\n      # [ 'create tbl name',                        '-ctable-ctableh-mi-eci-i-[uq]i-t$'         ]\n      # [ 'create view name',                         '-cview-mi-eci-i-[uq]i-t$'                  ]\n      # [ 'tbl alias',                              '-tn-ta-[uq]i-t$'                           ]\n      # [ 'col alias',                                '-nes-ne-eci-i-[uq]i-t$'                    ]\n      # [ 'col alias (also SQL kw)',                  '-nes-ne-eci-i-[uq]i-ansinr-t$'             ]\n      # [ 'col in order by',                          '-qo-si-e-pd-ve-cref-i-[uq]i-t$'            ]\n      # [ 'id in join criteria',                      '-jc[ou]-.*-i-[uq]i-t$'                     ]\n      #.....................................................................................................\n      { code, name, } = @_code_and_name_from_tcat_name name\n      if ( @db.single_value SQL\"select count(*) from tcats where code = $code\", { code, } ) is 0\n        code  = \"X#{code}\"\n        name  = \"X #{name}\"\n        @db SQL\"insert into tcats ( code, name ) values ( $code, $name )\", { code, name, }\n      @db SQL\"insert into tcat_rules ( code, matcher ) values ( $code, $matcher );\", { code, matcher, }\n    #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _code_and_name_from_tcat_name: ( cname ) ->\n    code  = cname.replace /-/g, ' '\n    name  = cname.replace /-/g, ''\n    switch code[ 0 ]\n      when 'xxx'\n        # group letter + initials of following words\n        code  = code.replace /(?:^|\\s+)(.)\\S*/g, '$1'\n      else\n        # group letter + up to four letters of word 1 but no trailing vowel + initials of words 2 and on\n        head  = code.replace /^(\\S+)\\s+(\\S{1,3}[^aeiou\\s]?).*$/, '$1$2'\n        # debug '^456-1^', { cname, code, head, }\n        tail  = code.replace /^\\S+\\s+\\S+\\s*/, ''\n        # debug '^456-2^', { cname, code, tail, }\n        tail  = tail.replace /(?:^|\\s+)(.)\\S*/g, '$1'\n        # debug '^456-3^', { cname, code, tail, }\n        code  = head + tail\n        # info '^456-3^', { cname, code, }\n    return { code, name, }\n\n  #---------------------------------------------------------------------------------------------------------\n  _procure_infrastructure: ->\n    ### TAINT check if tables exist ###\n    @db.create_stdlib()\n    pathsep_lit = @db.sql.L @constructor.C.pathsep\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create table ntypes ( -- node types\n          name    text not null primary key,\n          short   text not null unique );\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create table tcats ( -- terminal category codes\n          code    text not null primary key,\n          name    text not null unique );\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create table tcat_rules (\n          id      integer not null primary key,\n          code    text not null references tcats,\n          type    text not null default 're',\n          matcher text not null,\n        check ( type = 're' ) );\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create view tcat_matches as select\n          tc.code   as code,\n          tc.name   as name,\n          -- tr.id     as rid,\n          nd.path   as path,\n          nd.pos1   as pos1,\n          nd.pos2   as pos2,\n          nd.txt    as txt\n        from nodes      as nd\n        join tcat_rules as tr on ( std_re_is_match( nd.path, tr.matcher ) )\n        join tcats      as tc using ( code )\n        order by nd.pos1\n        ;\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create table queries (\n          qid     integer not null primary key,\n          length  integer generated always as ( length( query ) ),\n          query   text    not null );\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create table raw_nodes (\n          qid     integer not null,\n          id      integer not null,\n          xtra    integer not null default 1,\n          upid    integer,\n          type    text    not null,\n          path    text    not null,\n          pos1    integer,\n          pos2    integer,\n          lnr1    integer,\n          col1    integer,\n          lnr2    integer,\n          col2    integer,\n        primary key ( qid, id, xtra ),\n        foreign key ( qid ) references queries\n        -- foreign key ( upid ) references raw_nodes ( id ) DEFERRABLE INITIALLY DEFERRED\n        );\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create view _coverage_1 as select\n          n.qid                                                           as qid,\n          n.id                                                            as id,\n          n.xtra                                                          as xtra,\n          n.upid                                                          as upid,\n          n.type                                                          as type,\n          n.path                                                          as path,\n          n.pos1                                                          as pos1,\n          n.pos2                                                          as pos2,\n          n.lnr1                                                          as lnr1,\n          n.col1                                                          as col1,\n          n.lnr2                                                          as lnr2,\n          n.col2                                                          as col2,\n          substring( q.query, n.pos1, n.pos2 - n.pos1 + 1 )               as txt\n        from raw_nodes as n\n        join queries as q using ( qid )\n        where pos1 is not null;\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create view _coverage_holes_1 as select\n          c.qid                                                           as qid,\n          c.id                                                            as id,\n          c.xtra                                                          as prv_xtra,\n          c.upid                                                          as prv_upid,\n          c.type                                                          as prv_type,\n          c.path                                                          as prv_path,\n          c.pos1                                                          as pos1,\n          c.pos2                                                          as pos2,\n          c.pos2 + 1                                                      as nxt_pos1,\n          lead( c.pos1 ) over w - 1                                       as nxt_pos2,\n          -- ### TAINT the line and column numbers of coverage holes are those from the\n          -- preceding recognized terminal, not those of the added space & solid material.\n          -- As such, these numbers are out of sync with the `pos1`, `pos2` fields.\n          -- This should be fixed in a future iteration.\n          c.lnr1                                                          as lnr1,\n          c.col1                                                          as col1,\n          c.lnr2                                                          as lnr2,\n          c.col2                                                          as col2,\n          c.txt                                                           as txt\n        from _coverage_1 as c\n        window w as ( partition by qid order by pos1 );\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create view _coverage_holes_2 as select\n          c.qid                                                           as qid,\n          c.id                                                            as id,\n          c.prv_xtra                                                      as prv_xtra,\n          c.prv_upid                                                      as prv_upid,\n          c.prv_type                                                      as prv_type,\n          c.prv_path                                                      as prv_path,\n          c.nxt_pos1                                                      as pos1,\n          c.nxt_pos2                                                      as pos2,\n          c.lnr1                                                          as lnr1,\n          c.col1                                                          as col1,\n          c.lnr2                                                          as lnr2,\n          c.col2                                                          as col2,\n          substring( q.query, c.nxt_pos1, c.nxt_pos2 - c.nxt_pos1 + 1 )   as txt\n        from _coverage_holes_1  as c\n        join queries            as q using ( qid )\n        where c.nxt_pos1 <= c.nxt_pos2;\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create view _coverage_holes as select\n          c.qid                                                           as qid,\n          c.id                                                            as id,\n          2                                                               as xtra,\n          c.prv_upid                                                      as upid,\n          r.type                                                          as type,\n          c.prv_path || #{pathsep_lit} || r.type                          as path,\n          c.pos1                                                          as pos1,\n          c.pos2                                                          as pos2,\n          c.lnr1                                                          as lnr1,\n          c.col1                                                          as col1,\n          c.lnr2                                                          as lnr2,\n          c.col2                                                          as col2,\n          c.txt                                                           as txt\n        from _coverage_holes_2  as c\n        join ( select\n            qid,\n            id,\n            case when std_str_is_blank( txt ) then 'spc'\n              else 'miss' end                                             as type\n          from _coverage_holes_2 ) as r using ( qid, id );\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create view coverage as select\n          *\n        from _coverage_1\n        where txt != ''\n      union all select\n          *\n        from _coverage_holes\n        order by qid, pos1;\"\"\"\n    #.......................................................................................................\n    @db SQL\"\"\"\n      create view nodes as select\n          *,\n          null as txt\n        from raw_nodes\n        where pos1 is null\n      union all select\n          *\n        from coverage\n        order by qid, id, xtra;\"\"\"\n    #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile_sql: ->\n    pathsep_lit = @db.sql.L @constructor.C.pathsep\n    GUY.props.hide @, 'statements',\n      #.....................................................................................................\n      insert_query: @db.prepare_insert\n        into:         'queries'\n        exclude:      [ 'qid', ]\n        returning:    '*'\n      #.....................................................................................................\n      insert_special_node: @db.prepare_insert\n        into:         'raw_nodes'\n        returning:    '*'\n      #.....................................................................................................\n      insert_regular_node: @db.prepare SQL\"\"\"\n        insert into raw_nodes ( qid, id, upid, type, path, pos1, pos2, lnr1, col1, lnr2, col2 )\n          with\n            t as ( select *                 from ntypes      where name = $type ),\n            r as ( select *, count(*) as _  from raw_nodes  where qid = $qid and id = $upid and xtra = 1 )\n          select\n              $qid,\n              ( select coalesce( max( id ), 0 ) + 1 as id from raw_nodes ),\n              $upid,\n              $type,\n              coalesce( r.path, '' ) || #{pathsep_lit} || t.short,\n              $pos1, $pos2, $lnr1, $col1, $lnr2, $col2\n            from t, r\n            where true\n          returning *;\"\"\"\n      #.....................................................................................................\n      insert_start_node: @db.prepare SQL\"\"\"\n        insert into raw_nodes ( qid, id, xtra, upid, type, path, pos1, pos2, lnr1, col1, lnr2, col2 )\n          values (\n            $qid, 1, 1, null, 'start', 'start', 1, 0, 0, 0, 0, 0 )\n          returning *;\"\"\"\n      #.....................................................................................................\n      insert_stop_node: @db.prepare SQL\"\"\"\n        insert into raw_nodes ( qid, id, xtra, upid, type, path, pos1, pos2, lnr1, col1, lnr2, col2 )\n          values (\n            $qid,\n            ( select coalesce( max( id ), 0 ) + 1 as id from raw_nodes ),\n            1, null, 'stop', 'stop',\n            -- ### TAINT would use CET but fails with \"no such column: v.length\"\n            ( select length + 1 from queries where qid = $qid ),\n            ( select length     from queries where qid = $qid ),\n            0, 0, 0, 0 )\n          returning *;\"\"\"\n      #.....................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  parse: ( query ) ->\n    parser_cfg      =\n      doubleQuotedIdentifier: true\n    antlr           = { children: [ ( ANTLR.parse query, parser_cfg ).tree, ], }\n    R               = { type: 'query', nodes: [], }\n    { qid, }        = @statements.insert_query.get { query, }\n    R.nodes.push @statements.insert_start_node.get { qid, }\n    @_build_tree qid, query, antlr, null, R\n    R.nodes.push @statements.insert_stop_node.get { qid, }\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  _build_tree: ( qid, query, antlr, parent, tree ) ->\n    pathsep = @constructor.C.pathsep\n    for branch in antlr.children\n      type            = @_type_of_antler_node branch\n      position        = @_position_from_branch branch\n      txt             = null\n      upid            = parent?.id ? null\n      flat_node       = { qid, upid, type, position..., }\n      @db SQL\"savepoint svp_name;\"\n      flat_node       = @statements.insert_regular_node.get flat_node\n      node            = { flat_node..., nodes: [], }\n      if branch.children?\n        @_build_tree qid, query, branch, flat_node, node\n      if ( node.type isnt 'terminal' ) and ( node.nodes.length is 0 )\n        @db SQL\"rollback transaction to savepoint svp_name;\" # , { svp_name, }\n      else\n        @db SQL\"release svp_name;\"\n        tree.nodes.push node\n      delete node.nodes if node.nodes.length is 0\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _type_of_antler_node: ( node ) ->\n    R = node.constructor.name\n    R = R.replace /(Node|(Default)?Context)$/, ''\n    R = to_snake_case R\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  _position_from_branch: ( branch ) ->\n    if branch._symbol?\n      pos1  = branch._symbol.start + 1\n      lnr1  = branch._symbol._line\n      col1  = branch._symbol._charPositionInLine + 1\n      pos2  = branch._symbol.stop  + 1\n      lnr2  = branch._symbol._line\n      col2  = branch._symbol._charPositionInLine + 1 + branch._symbol.stop - branch._symbol.start\n    else\n      pos1  = null\n      lnr1  = null\n      col1  = null\n      pos2  = null\n      lnr2  = null\n      col2  = null\n    return { pos1, lnr1, col1, pos2, lnr2, col2, }\n"
  ]
}